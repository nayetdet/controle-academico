<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:replace="~{layout :: layout(~{::section})}">
    <section>
        <div class="page-header">
            <h1 th:text="${modoEdicao} ? 'Editar matrícula' : 'Nova matrícula'"></h1>
            <a class="btn btn-secondary" th:href="@{/matriculas}">Voltar</a>
        </div>
        <div class="card">
            <form th:action="${modoEdicao} ? @{|/matriculas/${matriculaSelecionada.aluno().matricula()}/${matriculaSelecionada.disciplina().codigo()}|} : @{/matriculas}"
                  method="post"
                  th:object="${modoEdicao} ? ${matriculaUpdateRequest} : ${matriculaRequest}"
                  class="form-grid">

                <div class="alert error" th:if="${#fields.hasGlobalErrors()}"
                     th:text="${#fields.globalErrors()[0]}"></div>

                <div class="form-group" th:if="${!modoEdicao}">
                    <label for="matriculaAluno">Aluno</label>
                    <select id="matriculaAluno" th:field="*{matriculaAluno}" required>
                        <option value="" disabled selected>Selecione um aluno</option>
                        <option th:each="aluno : ${alunos}"
                                th:value="${aluno.matricula()}"
                                th:text="${aluno.nome()} + ' (' + aluno.matricula() + ')'">
                        </option>
                    </select>
                    <div class="field-error" th:errors="*{matriculaAluno}"></div>
                </div>

                <div class="form-group" th:if="${modoEdicao}">
                    <label>Aluno</label>
                    <input type="text"
                           th:value="${matriculaSelecionada.aluno().nome()} + ' (' + matriculaSelecionada.aluno().matricula() + ')'"
                           readonly>
                </div>

                <div class="form-group" th:if="${!modoEdicao}">
                    <label for="codigoDisciplina">Disciplina</label>
                    <select id="codigoDisciplina" th:field="*{codigoDisciplina}" required>
                        <option value="" disabled selected>Selecione uma disciplina</option>
                        <option th:each="disciplina : ${disciplinas}"
                                th:value="${disciplina.codigo()}"
                                th:text="${disciplina.nome()} + ' (' + disciplina.codigo() + ')'">
                        </option>
                    </select>
                    <div class="field-error" th:errors="*{codigoDisciplina}"></div>
                </div>

                <div class="form-group" th:if="${modoEdicao}">
                    <label>Disciplina</label>
                    <input type="text"
                           th:value="${matriculaSelecionada.disciplina().nome()} + ' (' + matriculaSelecionada.disciplina().codigo() + ')'"
                           readonly>
                </div>

                <div class="form-group">
                    <label for="dataMatricula">Data da matrícula</label>
                    <input id="dataMatricula" type="date" th:field="*{dataMatricula}" required>
                    <div class="field-error" th:errors="*{dataMatricula}"></div>
                </div>

                <div class="form-group">
                    <label for="situacao">Situação</label>
                    <select id="situacao" th:field="*{situacao}" required>
                        <option th:each="situacao : ${situacoesMatricula}"
                                th:value="${situacao}"
                                th:text="${situacao}">
                        </option>
                    </select>
                    <div class="field-error" th:errors="*{situacao}"></div>
                </div>

                <div class="form-group">
                    <label for="notaFinal">Nota final (opcional)</label>
                    <input id="notaFinal" type="number" min="0" step="0.01" th:field="*{notaFinal}">
                    <div class="field-error" th:errors="*{notaFinal}"></div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" th:text="${modoEdicao} ? 'Salvar' : 'Cadastrar'"></button>
                    <a class="btn btn-secondary" th:href="@{/matriculas}">Cancelar</a>
                </div>
            </form>
        </div>
    </section>
</div>
</body>
</html>
